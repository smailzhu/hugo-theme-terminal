{{ define "main" }}
<div class="post">
  <h1 class="post-title">
    <a href="{{ .Permalink }}">{{ .Title | markdownify }}</a></h1>
  <div class="post-meta">
    {{ if .Params.PublishDate }}
      <span title="{{ .PublishDate.Format "2006-01-02T15:04:00-07:00" }}" class="post-date">
        {{- .PublishDate.Format (or $.Site.Params.dateFormat "2006-Jun-02") -}}
      </span>
      {{ if ( and $.Site.Params.showLastUpdated (ne .PublishDate .Lastmod)) }}
      <span title="{{ .Lastmod.Format "2006-01-02T15:04:00-07:00"  }}" class="post-date">
        [{{or $.Site.Params.updatedDatePrefix "Updated"}}: {{ .Lastmod.Format (or $.Site.Params.dateFormat "2006-Jun-02") }}]
      </span>
      {{ end }}
    {{ end }}
    {{ with .Params.Author }}
    <span class="post-author">:: {{ . }}</span>
    {{ end }}
  </div>

  {{ if .Params.categories }}
  <span class="post-tags">Categories: |
    {{ range .Params.categories }}
    <a href="{{ (urlize (printf "categories/%s/" .)) | absLangURL }}">{{ . }}</a>&nbsp;|
    {{ end }}
  </span>
  {{ end }}

  {{ if .Params.tags }}
  <span class="post-tags">Tags:
    {{ range .Params.tags }}
    #<a href="{{ (urlize (printf "tags/%s/" .)) | absLangURL }}">{{ . }}</a>&nbsp;
    {{ end }}
  </span>
  {{ end }}

  {{ if .Params.Cover }}
    <figure>
    <img src="{{ .Params.Cover | absURL }}" class="post-cover" alt="{{ (or .Params.CoverAlt .Title) |  plainify | default " " }}" />
    </figure>
  {{ end }}

  {{ if .Params.Toc }}
    <div class="table-of-contents">
      <h2>
        {{ if .Params.TocTitle }}
          {{ .Params.TocTitle }}
        {{ else if $.Site.Params.TocTitle }}
          {{ $.Site.Params.TocTitle }}
        {{ else }}
          Table of Contents
        {{ end }}
      </h2>
      {{ .TableOfContents }}
    </div>
  {{ end }}

  <div class="post-content">
    {{- with .Content -}}
      <div>
        {{ . | replaceRE "(<h[1-9] id=\"([^\"]+)\".+)(</h[1-9]+>)" `${1}<a href="#${2}" class="hanchor" ariaLabel="Anchor">&#8983;</a> ${3}` | safeHTML }}
      </div>
    {{- end -}}
  </div>

  {{ if eq .Type $.Site.Params.contentTypeName }}
  {{ partial "posts_pagination.html" . }}
  {{ end }}

  {{ partial "comments.html" . }}
</div>
{{ end }}
